<!DOCTYPE html><!--This file is part of cfillion_Song switcher.lua--><html><head><meta charset="utf-8" /><meta content="yes" name="apple-mobile-web-app-capable" /><meta content="width=device-width, initial-scale=1" name="viewport" /><title>Song switcher remote control</title><style>html,body,.vlayout{height:100%;margin:0}body{background-color:#000;box-sizing:border-box;color:#fff;font-family:sans-serif;font-size:50px;padding:10px 20px 0 20px;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}div{cursor:default;padding:10px 0 10px 0}.vlayout{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:justify;justify-content:space-between}.vlayout>*{-ms-flex-negative:0;flex-shrink:0;margin-bottom:10px}.hlayout{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex}.vlayout,.hlayout,#controls,#song_box{padding:0}#lock-overlay{position:fixed;top:0;left:0;right:0;bottom:0}#song_box{-ms-flex-positive:1;flex-grow:1;word-wrap:break-word;min-width:10px}#song_box span{display:block}#song_box input{background-color:#2e2e2e;border-style:none;color:inherit;display:none;font-size:inherit;text-align:inherit;width:100%}#song_box.edit span{display:none}#song_box.edit input{display:block}#prev,#next{min-width:50px;border:none}.button{border:1px #fff solid;padding:10px}.button:hover:not(.active){background-color:#2e2e2e}.button:active:not(.active){background-color:#3c5a64;color:inherit}.button.active{background-color:#7ca5d7;color:#000}#play{font-size:.7em}#play.record{background-color:#af5f5f}#play.paused{background-color:#dd9815}#timeline{height:100px;-ms-interpolation-mode:nearest-neighbor;image-rendering:-moz-crisp-edges;image-rendering:pixelated;line-height:100px;width:100%}#lock{z-index:1000}#footer{-ms-flex-align:end;align-items:flex-end;font-size:12px}#footer .button{padding:10px 15px 10px 15px;margin-right:10px}#about{-ms-flex-positive:1;flex-grow:1;padding:0;text-align:right;z-index:1000}.invalid{background-color:red}.hidden{visibility:hidden}a{color:#7ca5d7}@media (max-height: 425px){.spacer{display:none}}@media (max-height: 320px){body{font-size:40px}#timeline{height:80px}}
</style><script src="/main.js"></script></head><body><div class="hidden" id="lock-overlay"></div><div class="vlayout"><div class="spacer"><!--Top spacer--></div><div class="hlayout invalid" id="controls"><div class="button hidden" id="prev">&#9664;</div><div id="song_box"><span id="title">Oops! Javascript is blocked or disabled.</span><input id="filter" spellcheck="false" type="text" /></div><div class="button hidden" id="next">&#9654;</div></div><canvas id="timeline"></canvas><div class="button" id="play">Play/Stop</div><div class="hlayout" id="footer"><div class="button" id="panic">MIDI panic</div><div class="button" id="reset">Reset data</div><div class="button" id="lock"> Lock</div><div id="about"><a href="https://forum.cockos.com/showthread.php?t=181159" target="_blank">Song switcher remote control</a> by cfillion</div></div></div><script>(function(t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t()}else if(typeof define==="function"&&define.amd){define([],t)}else{var e;if(typeof window!=="undefined"){e=window}else if(typeof global!=="undefined"){e=global}else if(typeof self!=="undefined"){e=self}else{e=this}e.SongSwitcherWWW=t()}})(function(){var t,e,i;return function(){function t(e,i,n){function r(o,h){if(!i[o]){if(!e[o]){var u="function"==typeof require&&require;if(!h&&u)return u(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=i[o]={exports:{}};e[o][0].call(l.exports,function(t){var i=e[o][1][t];return r(i||t)},l,l.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}return t}()({1:[function(t,e,i){var n,r,s,o,h,u,f,l,a,c,p,d,y=function(t,e){for(var i in e){if(m.call(e,i))t[i]=e[i]}function n(){this.constructor=t}n.prototype=e.prototype;t.prototype=new n;t.a=e.prototype;return t},m={}.hasOwnProperty;u="cfillion_song_switcher";f="state";o="relative_move";s="filter";h="reset";n="TRANSPORT;MARKER;GET/EXTSTATE/"+u+"/"+f;l=t(7).EventEmitter;p=t(4);d=function(t){return Math.trunc(parseFloat(t)*1e3)/1e3};c=function(){function t(t){if(typeof t==="object"){this.b(t)}else{this.c(t||"## No data from host ##")}}t.prototype.b=function(t){var e;e=0;this.currentIndex=parseInt(t[e++]);this.songCount=parseInt(t[e++]);this.title=t[e++]||"## No song selected ##";this.startTime=d(t[e++]);this.endTime=d(t[e++]);return this.invalid=t[e++]==="true"};t.prototype.c=function(t){var e;this.currentIndex=this.songCount=this.startTime=this.endTime=0;return e=[t,true],this.title=e[0],this.invalid=e[1],e};return t}();a=function(){function t(t){var e;e=1;this.name=t[e++];this.id=t[e++];this.time=d(t[e++]);this.rawColor=parseInt(t[e++]);if(this.rawColor){this.color="#"+Number(this.rawColor&16777215).toString(16).padStart(6,"0")}}return t}();r=function(t){var e;y(i,t);e=function(t,e){return"SET/EXTSTATE/"+u+"/"+t+"/"+encodeURIComponent(e)};function i(t){var e;this.data={};this.d([]);(e=function(i){return function(){i.e("");return setTimeout(e,t)}}(this))()}i.prototype.play=function(){return this.e(40044)};i.prototype.relativeMove=function(t){return this.e(e(o,t))};i.prototype.setFilter=function(t){return this.e(e(s,t))};i.prototype.seek=function(t){return this.e("SET/POS/"+t)};i.prototype.panic=function(){return this.e(40345)};i.prototype.reset=function(){return this.e(e(h,"true"))};i.prototype.e=function(t){var e;e=new XMLHttpRequest;e.onreadystatechange=function(t){return function(){if(e.readyState===XMLHttpRequest.DONE){if(e.status===200){return t.f(e.responseText)}else{return t.d("## Network error ##")}}}}(this);e.open("GET","/_/"+t+";"+n,true);return e.send(null)};i.prototype.d=function(t){return this.g(function(e){e("playState",false);e("position",0);e("state",new c(t));return e("markerList",[])})};i.prototype.f=function(t){var e;e=[];return this.g(function(i){var n,r,s,o,h;o=t.split("\n");for(n=0,s=o.length;n<s;n++){r=o[n];h=r.split("\t");switch(h[0]){case"TRANSPORT":i("playState",parseInt(h[1]));i("position",d(h[2]));break;case"MARKER":e.push(new a(h));break;case"EXTSTATE":if(h[1]===u&&h[2]===f){i("state",h[3].length?new c(simple_unescape(h[3]).split("\t")):new c)}}}return i("markerList",e)})};i.prototype.g=function(t){var e,i,n,r,s;r=[];t(function(t){return function(e,i){if(!p(t.data[e],i)){t.data[e]=i;return r.push(e)}}}(this));s=[];for(e=0,n=r.length;e<n;e++){i=r[e];s.push(this.emit(i+"Changed",this.data[i]))}return s};return i}(l);e.exports=r},{4:4,7:7}],2:[function(t,e,i){var n,r,s,o;n=t(1);o=t(3);r="cfillion_song_switcher_lock";s=function(){function t(){this.h=new n(100);this.i=new o(document.getElementById("timeline"));this.j=document.getElementById("lock-overlay");this.k=document.getElementById("controls");this.l=document.getElementById("prev");this.m=document.getElementById("next");this.n=document.getElementById("play");this.o=document.getElementById("panic");this.p=document.getElementById("reset");this.q=document.getElementById("lock");this.r=document.getElementById("song_box");this.s=document.getElementById("title");this.t=document.getElementById("filter");this.u(this.s,"## Awaiting data ##");this.v(this.k,"invalid",false);this.i.update(this.h.data);this.h.on("playStateChanged",function(t){return function(e){t.v(t.n,"active",e>0);t.v(t.n,"record",e&4);return t.v(t.n,"paused",e&2)}}(this));this.h.on("stateChanged",function(t){return function(e){t.w(t.l,e.currentIndex>1);t.w(t.m,e.currentIndex<e.songCount);t.v(t.k,"invalid",e.invalid);t.u(t.s,e.title);return t.i.update(t.h.data)}}(this));this.h.on("positionChanged",function(t){return function(){return t.i.update(t.h.data)}}(this));this.h.on("markerListChanged",function(t){return function(){return t.i.update(t.h.data)}}(this));this.i.on("seek",function(t){return function(e){return t.h.seek(e)}}(this));this.l.addEventListener("click",function(t){return function(){return t.h.relativeMove(-1)}}(this));this.m.addEventListener("click",function(t){return function(){return t.h.relativeMove(1)}}(this));this.n.addEventListener("click",function(t){return function(){return t.h.play()}}(this));this.o.addEventListener("click",function(t){return function(){return t.h.panic()}}(this));this.p.addEventListener("click",function(t){return function(){return t.h.reset()}}(this));this.q.addEventListener("click",function(t){return function(){if(t.x()){if(!confirm("Are you sure?")){return}localStorage.removeItem(r)}else{localStorage.setItem(r,true)}return t.y()}}(this));this.s.addEventListener("click",function(t){return function(){t.v(t.r,"edit",true);return t.t.focus()}}(this));this.t.addEventListener("blur",function(t){return function(){return t.z()}}(this));this.t.addEventListener("keypress",function(t){return function(e){if(e.keyCode===8&&!t.t.value.length){t.z()}else if(e.keyCode!==13){return}if(t.t.value.length>0){t.h.setFilter(t.t.value)}return t.z()}}(this));window.addEventListener("resize",function(t){return function(){return t.i.update(t.h.data)}}(this));window.addEventListener("keydown",function(t){return function(e){if(!t.x()&&e.keyCode===32&&e.target===document.body){return t.h.play()}}}(this));window.addEventListener("beforeunload",function(t){return function(e){var i;if(t.x()){i="Are you sure?";return e.returnValue=i}}}(this));if(localStorage.getItem(r)){this.y()}}t.prototype.u=function(t,e){var i;if(i=t.lastChild){return i.nodeValue=e}else{return t.appendChild(document.createTextNode(e))}};t.prototype.v=function(t,e,i){if(i==null){i=true}if(i){return t.classList.add(e)}else{return t.classList.remove(e)}};t.prototype.w=function(t,e){return this.v(t,"hidden",!e)};t.prototype.z=function(){this.v(this.r,"edit",false);this.t.value="";return document.activeElement.blur()};t.prototype.x=function(){return this.q.classList.contains("active")};t.prototype.y=function(){this.j.classList.toggle("hidden");return this.q.classList.toggle("active")};return t}();e.exports=s},{1:1,3:3}],3:[function(t,e,i){var n,r,s,o,h,u,f,l,a,c,p,d,y,m,v,g,w,E,T,L,b,D,$=function(t,e){for(var i in e){if(k.call(e,i))t[i]=e[i]}function n(){this.constructor=t}n.prototype=e.prototype;t.prototype=new n;t.a=e.prototype;return t},k={}.hasOwnProperty;m="#2e2e2e";E="black";f=15;u="sans-serif";n=1;r=-1;y=20;s="yellow";o=3;l="#888888";a=1;p="white";c="red";d=2;T=1;L=2;b=3;w=50;v="orange";g=500;h=t(7).EventEmitter;D=function(t){$(e,t);function e(t){var e,i,n,r;this.A=t;this.B=[];this.C=f;this.D=this.A.getContext("2d");this.F="ontouchstart"in window;i=this.F?"touchstart":"mousedown";n=this.F?"touchmove":"mousemove";r=this.F?"touchend":"mouseup";e=this.F?"touchend":"click";this.A.addEventListener(i,function(t){return function(){var e;return e=[new Date,false],t.G=e[0],t.H=e[1],e}}(this));window.addEventListener(r,function(t){return function(){t.G=null;if(t.I){t.I=null;return t.update(t.J)}}}(this));window.addEventListener(n,function(t){return function(e){var i,n,r,s;n=t.K(e),r=n[0],s=n[1];if(t.G&&t.G<new Date-g){i=Math.max(1,Math.min(r,t.A.width));t.H=true;t.I=t.L(i);t.update(t.J)}if(t.M(r,s)){e.preventDefault();return false}}}(this));this.A.addEventListener(e,function(t){return function(e){var i,n,r;i=t.K(e),n=i[0],r=i[1];if(!t.M(n,r)){return}if(!t.H){n=t.N(n)}return t.emit("seek",t.L(n)+t.J.state.startTime)}}(this))}e.prototype.update=function(t){var e,i,s,o;this.J=t;this.B.length=0;this.O();this.D.textBaseline="hanging";this.D.fillStyle=m;this.D.fillRect(0,this.C,this.A.width,this.P);this.Q(0);this.Q(this.J.state.endTime-this.J.state.startTime);o=this.J.markerList;for(e=0,i=o.length;e<i;e++){s=o[e];if(s.time>=this.J.state.startTime&&s.time<=this.J.state.endTime){this.R(s)}}this.S(this.J.position-this.J.state.startTime);if(this.J.position<this.J.state.startTime){this.T(n)}else if(this.J.position>this.J.state.endTime){this.T(r)}this.D.strokeStyle=this.D.fillStyle=v;if(this.I){this.U(this.I)}return this.B.sort(function(t,e){return t-e})};e.prototype.O=function(){var t;t=[this.A.clientWidth,this.A.clientHeight],this.A.width=t[0],this.A.height=t[1];this.P=this.A.height-this.C*2;this.V=this.C+this.P;this.W=(this.J.state.endTime-this.J.state.startTime)/this.A.width;return this.W||(this.W=1/Math.pow(2,32))};e.prototype.S=function(t){var e;e=this.X(t);this.D.strokeStyle=this.D.fillStyle=s;this.D.lineWidth=o;this.D.beginPath();this.D.moveTo(e-this.C,0);this.D.lineTo(e,this.C+o);this.D.lineTo(e+this.C,0);this.D.fill();return this.U(t,false)};e.prototype.Q=function(t){this.D.strokeStyle=this.D.fillStyle=l;this.D.lineWidth=a;return this.U(t)};e.prototype.R=function(t){var e,i,n,r;r=t.time-this.J.state.startTime;n=this.X(r);e=n-d*2;this.D.fillStyle=m;this.D.fillRect(e,this.C,this.A.width-n,this.P);this.D.strokeStyle=this.D.fillStyle=t.color||c;this.D.lineWidth=d;this.U(r);if(t.name.length>0){this.D.font="bold "+f+"px "+u;i=this.D.measureText(t.name).width+d*2;this.D.fillRect(n,this.C,i,f);this.D.fillStyle=p;return this.D.fillText(t.name,n+d,this.C+2)}};e.prototype.U=function(t,e){var i,n,r,s,o,h,l,a;if(e==null){e=true}h=this.X(t);s=e?0:this.V+3;if(e){this.B.push(h)}this.D.beginPath();this.D.moveTo(h,this.C);this.D.lineTo(h,this.V);this.D.stroke();this.D.font=f+"px "+u;l=[this.D.fillStyle,E],o=l[0],this.D.fillStyle=l[1];i=this.Y(t,!e);a=this.Z(h,i,!e),r=a[0],n=a[1];this.D.fillRect(r,s,n,f);this.D.fillStyle=o;return this.D.fillText(i,r,s+1)};e.prototype.Z=function(t,e,i){var n,r;r=this.D.measureText(e).width;if(i){t-=r/2}if((n=t+r)>this.A.width){t-=n-this.A.width}t=Math.max(0,t);return[t,r]};e.prototype.T=function(t){var e,i,n,s;i=y;if(t===r){i=this.A.width-i}e=this.P/2.5;s=e;n=(this.A.height-e)/2;this.D.lineWidth=3;this.D.beginPath();this.D.moveTo(i+s*t,n);this.D.lineTo(i,n+e/2);this.D.lineTo(i+s*t,n+e);return this.D.stroke()};e.prototype.X=function(t){return t/this.W};e.prototype.L=function(t){return t*this.W};e.prototype.Y=function(t,e){var i,n,r,s,o,h;h=t<0?"-":"";i=Math.abs(t/60);o=Math.abs(t%60);n=Math.abs(t*1e3);s=function(t,e){e=Math.trunc(e);return(t+e).slice(-t.length)};r=""+h+s("00",i)+":"+s("00",o);if(e){r+="."+s("000",n)}return r};e.prototype.N=function(t){var e,i,n,r,s,o;o=[-1,this.B.length],r=o[0],n=o[1];while(n-r>1){i=Math.round((r+n)/2);s=this.B[i];if(s<=t){r=i}else{n=i}}r=this.B[r]-t;n=this.B[n]-t;e=Math.min(Math.abs(r),Math.abs(n));if(e<w){return(e===Math.abs(r)?r:n)+t}else{return t}};e.prototype.M=function(t,e){return t>0&&t<=this.A.width&&e>0&&e<=this.A.height};e.prototype.K=function(t){var e,i;if(this.F){t=t.touches[0]||t.changedTouches[0]}e=t.pageX-this.A.offsetLeft;i=t.pageY-this.A.offsetTop;return[e,i]};return e}(h);e.exports=D},{7:7}],4:[function(t,e,i){var n=Array.prototype.slice;var r=t(6);var s=t(5);var o=e.exports=function(t,e,i){if(!i)i={};if(t===e){return true}else if(t instanceof Date&&e instanceof Date){return t.getTime()===e.getTime()}else if(!t||!e||typeof t!="object"&&typeof e!="object"){return i.strict?t===e:t==e}else{return f(t,e,i)}};function h(t){return t===null||t===undefined}function u(t){if(!t||typeof t!=="object"||typeof t.length!=="number")return false;if(typeof t.copy!=="function"||typeof t.slice!=="function"){return false}if(t.length>0&&typeof t[0]!=="number")return false;return true}function f(t,e,i){var f,l;if(h(t)||h(e))return false;if(t.prototype!==e.prototype)return false;if(s(t)){if(!s(e)){return false}t=n.call(t);e=n.call(e);return o(t,e,i)}if(u(t)){if(!u(e)){return false}if(t.length!==e.length)return false;for(f=0;f<t.length;f++){if(t[f]!==e[f])return false}return true}try{var a=r(t),c=r(e)}catch(t){return false}if(a.length!=c.length)return false;a.sort();c.sort();for(f=a.length-1;f>=0;f--){if(a[f]!=c[f])return false}for(f=a.length-1;f>=0;f--){l=a[f];if(!o(t[l],e[l],i))return false}return typeof t===typeof e}},{5:5,6:6}],5:[function(t,e,i){var n=function(){return Object.prototype.toString.call(arguments)}()=="[object Arguments]";i=e.exports=n?r:s;i.supported=r;function r(t){return Object.prototype.toString.call(t)=="[object Arguments]"}i.unsupported=s;function s(t){return t&&typeof t=="object"&&typeof t.length=="number"&&Object.prototype.hasOwnProperty.call(t,"callee")&&!Object.prototype.propertyIsEnumerable.call(t,"callee")||false}},{}],6:[function(t,e,i){i=e.exports=typeof Object.keys==="function"?Object.keys:n;i.shim=n;function n(t){var e=[];for(var i in t)e.push(i);return e}},{}],7:[function(t,e,i){function n(){this.$=this.$||{};this._=this._||undefined}e.exports=n;n.EventEmitter=n;n.prototype.$=undefined;n.prototype._=undefined;n.defaultMaxListeners=10;n.prototype.setMaxListeners=function(t){if(!s(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");this._=t;return this};n.prototype.emit=function(t){var e,i,n,s,u,f;if(!this.$)this.$={};if(t==="error"){if(!this.$.error||o(this.$.error)&&!this.$.error.length){e=arguments[1];if(e instanceof Error){throw e}else{var l=new Error('Uncaught, unspecified "error" event. ('+e+")");l.context=e;throw l}}}i=this.$[t];if(h(i))return false;if(r(i)){switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1);i.apply(this,s)}}else if(o(i)){s=Array.prototype.slice.call(arguments,1);f=i.slice();n=f.length;for(u=0;u<n;u++)f[u].apply(this,s)}return true};n.prototype.addListener=function(t,e){var i;if(!r(e))throw TypeError("listener must be a function");if(!this.$)this.$={};if(this.$.newListener)this.emit("newListener",t,r(e.listener)?e.listener:e);if(!this.$[t])this.$[t]=e;else if(o(this.$[t]))this.$[t].push(e);else this.$[t]=[this.$[t],e];if(o(this.$[t])&&!this.$[t].warned){if(!h(this._)){i=this._}else{i=n.defaultMaxListeners}if(i&&i>0&&this.$[t].length>i){this.$[t].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this.$[t].length);if(typeof console.trace==="function"){console.trace()}}}return this};n.prototype.on=n.prototype.addListener;n.prototype.once=function(t,e){if(!r(e))throw TypeError("listener must be a function");var i=false;function n(){this.removeListener(t,n);if(!i){i=true;e.apply(this,arguments)}}n.listener=e;this.on(t,n);return this};n.prototype.removeListener=function(t,e){var i,n,s,h;if(!r(e))throw TypeError("listener must be a function");if(!this.$||!this.$[t])return this;i=this.$[t];s=i.length;n=-1;if(i===e||r(i.listener)&&i.listener===e){delete this.$[t];if(this.$.removeListener)this.emit("removeListener",t,e)}else if(o(i)){for(h=s;h-- >0;){if(i[h]===e||i[h].listener&&i[h].listener===e){n=h;break}}if(n<0)return this;if(i.length===1){i.length=0;delete this.$[t]}else{i.splice(n,1)}if(this.$.removeListener)this.emit("removeListener",t,e)}return this};n.prototype.removeAllListeners=function(t){var e,i;if(!this.$)return this;if(!this.$.removeListener){if(arguments.length===0)this.$={};else if(this.$[t])delete this.$[t];return this}if(arguments.length===0){for(e in this.$){if(e==="removeListener")continue;this.removeAllListeners(e)}this.removeAllListeners("removeListener");this.$={};return this}i=this.$[t];if(r(i)){this.removeListener(t,i)}else if(i){while(i.length)this.removeListener(t,i[i.length-1])}delete this.$[t];return this};n.prototype.listeners=function(t){var e;if(!this.$||!this.$[t])e=[];else if(r(this.$[t]))e=[this.$[t]];else e=this.$[t].slice();return e};n.prototype.listenerCount=function(t){if(this.$){var e=this.$[t];if(r(e))return 1;else if(e)return e.length}return 0};n.listenerCount=function(t,e){return t.listenerCount(e)};function r(t){return typeof t==="function"}function s(t){return typeof t==="number"}function o(t){return typeof t==="object"&&t!==null}function h(t){return t===void 0}},{}]},{},[2])(2)});new SongSwitcherWWW()</script></body></html>
